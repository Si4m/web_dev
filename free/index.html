<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Family Learning Portal — Prototype</title>
  <style>
    :root{font-family:system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial;}
    body{max-width:900px;margin:28px auto;padding:18px;color:#111;background:#f7f8fb}
    header{display:flex;align-items:center;justify-content:space-between}
    h1{font-size:20px;margin:0}
    .card{background:#fff;border-radius:12px;box-shadow:0 6px 20px rgba(20,30,50,.06);padding:18px;margin-top:16px}
    label{display:block;margin:10px 0 6px;font-weight:600}
    input[type=text],input[type=password]{width:100%;padding:10px;border-radius:8px;border:1px solid #ddd}
    button{padding:10px 12px;border-radius:8px;border:0;background:#2563eb;color:white;font-weight:600;cursor:pointer}
    .muted{color:#666;font-size:13px}
    nav{display:flex;gap:8px}
    .link{display:inline-block;padding:6px 10px;border-radius:8px;background:#eef2ff;color:#1e3a8a}
    .grid{display:grid;grid-template-columns:1fr 320px;gap:16px}
    .user{padding:10px;border-radius:8px;border:1px solid #eee;margin-bottom:8px}
    .danger{background:#fff3f2;color:#b91c1c;border:1px solid #ffd6d5}
    pre{background:#0b1220;color:#cfe8ff;padding:10px;border-radius:8px;overflow:auto}
    footer{margin-top:18px;color:#666;font-size:13px}
  </style>
</head>
<body>
  <header>
    <h1>Family Learning Portal — Prototype</h1>
    <nav>
      <div class="muted">Local prototype</div>
    </nav>
  </header>

  <section class="card">
    <strong>Note:</strong>
    <div class="muted">এই টেমপ্লেটটি কেবল **প্রোটোটাইপ**। সব ইউজার-ডেটা ব্রাউজারের <code>localStorage</code>-এ রাখে। প্রোডাকশনে ব্যবহার করলে অবশ্যই সার্ভার ও সঠিক authentication প্রয়োগ করবেন (HTTPS + server-side DB)।</div>
  </section>

  <div class="grid">
    <div>
      <section class="card">
        <h3>Loge in</h3>
        <div id="loginArea">
          <label for="loginUser">User/Email</label>
          <input id="loginUser" type="text" placeholder="example@family.com" />
          <label for="loginPass">পাসওয়ার্ড</label>
          <input id="loginPass" type="password" placeholder="password" />
          <div style="margin-top:12px;display:flex;gap:8px;align-items:center">
            <button id="btnLogin">Log in</button>
            <button id="btnShowRegister" style="background:#10b981">Register</button>
            <div id="loginMsg" class="muted"></div>
          </div>
        </div>

        <div id="memberArea" style="display:none;margin-top:12px">
          <div class="muted">Logged in as <strong id="who"></strong></div>
          <div style="margin-top:10px">
            <button id="btnLogout" style="background:#ef4444">Logout</button>
          </div>

          <hr style="margin:12px 0"/>

          <h4>Learning Links</h4>
          <div id="linksList" class="muted">(No links yet)</div>
        </div>
      </section>

      <section class="card" id="registerCard" style="display:none;margin-top:14px">
        <h3>Register new family user</h3>
        <label for="regUser">Username / Email</label>
        <input id="regUser" type="text" placeholder="jannat@example.com" />
        <label for="regPass">Password</label>
        <input id="regPass" type="password" placeholder="choose a password" />
        <label for="regRole">Role</label>
        <select id="regRole" style="padding:8px;border-radius:8px">
          <option value="member">Member</option>
          <option value="admin">Admin</option>
        </select>
        <div style="margin-top:10px;display:flex;gap:8px">
          <button id="btnRegister">Create user</button>
          <button id="btnCancelReg" style="background:#9ca3af">Cancel</button>
          <div id="regMsg" class="muted"></div>
        </div>
        <div class="muted" style="margin-top:10px">Admin users can add/remove links & revoke accounts.</div>
      </section>

      <section class="card" style="margin-top:14px">
        <h3>Admin — Add learning link</h3>
        <label for="linkTitle">Title</label>
        <input id="linkTitle" type="text" placeholder="Course on JavaScript" />
        <label for="linkHref">URL (public link or your resource)</label>
        <input id="linkHref" type="text" placeholder="https://www.udemy.com/...." />
        <div style="margin-top:10px;display:flex;gap:8px">
          <button id="btnAddLink">Add link</button>
          <div id="addLinkMsg" class="muted"></div>
        </div>
        <div class="muted" style="margin-top:8px"><strong>Important:</strong> Do not upload or redistribute paid content. Rather store pointers/links to where users should go to access courses legally.</div>
      </section>

    </div>

    <aside>
      <section class="card">
        <h4>Users</h4>
        <div id="usersList" class="muted">(no users)</div>
      </section>

      <section class="card" style="margin-top:12px">
        <h4>Danger Zone</h4>
        <div class="danger">
          <p class="muted">Remove all users / reset portal</p>
          <div style="display:flex;gap:8px">
            <button id="btnReset" style="background:#b91c1c">Reset portal</button>
            <div id="resetMsg" class="muted"></div>
          </div>
        </div>
      </section>

      <section class="card" style="margin-top:12px">
        <h4>How it works</h4>
        <ol class="muted">
          <li>Admin creates users from Register panel.</li>
          <li>Passwords are hashed (SHA-256) before saving to localStorage (client-side hashing only).</li>
          <li>Admin can add link items; members can view them on login.</li>
          <li>For real security use server-side auth (this is only local demo).</li>
        </ol>
      </section>
    </aside>
  </div>

  <footer>
    <small>Prototype — not production-ready. Need help to convert to server-backed app? I can provide Express/Node + SQLite example next.</small>
  </footer>


  <script>
    // -----------------------------
    // Simple client-side prototype
    // -----------------------------

    // Utilities
    const $ = id => document.getElementById(id);

    // Web Crypto to hash password before storing (not a replacement for server-side auth)
    async function sha256hex(text){
      const enc = new TextEncoder();
      const data = enc.encode(text);
      const hash = await crypto.subtle.digest('SHA-256', data);
      return Array.from(new Uint8Array(hash)).map(b=>b.toString(16).padStart(2,'0')).join('');
    }

    // Local storage keys
    const KEY_USERS = 'familyportal_users_v1';
    const KEY_LINKS = 'familyportal_links_v1';

    // Load/save helpers
    function loadUsers(){
      try{ return JSON.parse(localStorage.getItem(KEY_USERS) || '[]'); }catch(e){return []}
    }
    function saveUsers(u){ localStorage.setItem(KEY_USERS, JSON.stringify(u)); }
    function loadLinks(){ try{ return JSON.parse(localStorage.getItem(KEY_LINKS)||'[]'); }catch(e){return []} }
    function saveLinks(l){ localStorage.setItem(KEY_LINKS, JSON.stringify(l)); }

    // Render lists
    function renderUsers(){
      const users = loadUsers();
      const el = $('usersList');
      if(users.length===0){ el.innerText='(no users)'; return }
      el.innerHTML = '';
      users.forEach(u=>{
        const d = document.createElement('div'); d.className='user';
        d.innerHTML = `<strong>${escapeHtml(u.name)}</strong><div class="muted">role: ${u.role}</div>`;
        const btns = document.createElement('div'); btns.style.marginTop='8px';
        const del = document.createElement('button'); del.innerText='Revoke'; del.style.background='#ef4444';
        del.onclick = ()=>{ if(confirm('Revoke user '+u.name+'?')){ removeUser(u.name); } };
        btns.appendChild(del);
        d.appendChild(btns);
        el.appendChild(d);
      });
    }

    function renderLinks(){
      const links = loadLinks();
      const el = $('linksList');
      if(links.length===0){ el.innerText='(No links yet)'; return }
      el.innerHTML = '';
      links.forEach(l=>{
        const a = document.createElement('div');
        a.innerHTML = `<a href="${escapeHtml(l.href)}" target="_blank">${escapeHtml(l.title)}</a>`;
        el.appendChild(a);
      });
    }

    function escapeHtml(s){ return String(s).replace(/[&<>"']/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;" })[c]); }

    // User management
    async function createUser(name,password,role='member'){
      if(!name||!password) throw 'missing';
      const users = loadUsers();
      if(users.find(x=>x.name===name)) throw 'exists';
      const hash = await sha256hex(password);
      users.push({name,hash,role});
      saveUsers(users);
      renderUsers();
    }

    function removeUser(name){
      let users = loadUsers();
      users = users.filter(u=>u.name!==name);
      saveUsers(users); renderUsers();
      $('resetMsg').innerText = 'User revoked';
      setTimeout(()=>$('resetMsg').innerText='',1500);
    }

    // Authentication (client-side)
    async function login(name,password){
      const users = loadUsers();
      const u = users.find(x=>x.name===name);
      if(!u) throw 'notfound';
      const h = await sha256hex(password);
      if(h!==u.hash) throw 'badpass';
      sessionStorage.setItem('familyportal_session', JSON.stringify({name: u.name, role:u.role}));
      return u;
    }

    function logout(){ sessionStorage.removeItem('familyportal_session'); location.reload(); }

    function getSession(){ try{ return JSON.parse(sessionStorage.getItem('familyportal_session')||'null'); }catch(e){return null} }

    // Links
    function addLink(title,href){
      const links = loadLinks(); links.push({title,href}); saveLinks(links); renderLinks();
    }

    // Reset
    function resetPortal(){ if(confirm('Reset: remove ALL users & links?')){ localStorage.removeItem(KEY_USERS); localStorage.removeItem(KEY_LINKS); renderUsers(); renderLinks(); alert('reset done'); } }

    // Wire UI
    window.addEventListener('load', ()=>{
      renderUsers(); renderLinks();

      // Default: if no users, create an admin sample account
      if(loadUsers().length===0){
        // create sample admin with username: admin@local password: admin123 (please change)
        sha256hex('admin123').then(h=>{ localStorage.setItem(KEY_USERS, JSON.stringify([{name:'admin@local',hash:h,role:'admin'}])); renderUsers(); });
      }

      // Session check
      const s = getSession();
      if(s){
        $('loginArea').style.display='none';
        $('memberArea').style.display='block';
        $('who').innerText = s.name + ' ('+s.role+')';
        // Show admin-only panels
        if(s.role==='admin') $('registerCard').style.display='block';
      }

      // Buttons
      $('btnShowRegister').onclick = ()=>{ $('registerCard').style.display='block'; };
      $('btnCancelReg').onclick = ()=>{ $('registerCard').style.display='none'; };

      $('btnRegister').onclick = async ()=>{
        try{
          $('regMsg').innerText = 'Creating...';
          await createUser($('regUser').value.trim(), $('regPass').value, $('regRole').value);
          $('regMsg').innerText = 'Done'; setTimeout(()=>$('regMsg').innerText='',1200);
          $('regUser').value=''; $('regPass').value='';
        }catch(e){ $('regMsg').innerText = e; setTimeout(()=>$('regMsg').innerText='',1800); }
      };

      $('btnLogin').onclick = async ()=>{
        try{
          $('loginMsg').innerText = 'Checking...';
          await login($('loginUser').value.trim(), $('loginPass').value);
          location.reload();
        }catch(e){
          if(e==='notfound') $('loginMsg').innerText='User not found';
          else if(e==='badpass') $('loginMsg').innerText='Wrong password';
          else $('loginMsg').innerText='Error';
          setTimeout(()=>$('loginMsg').innerText='',2000);
        }
      };

      $('btnLogout').onclick = ()=>logout();
      $('btnAddLink').onclick = ()=>{
        const s = getSession(); if(!s||s.role!=='admin'){ $('addLinkMsg').innerText='Only admin can add links'; setTimeout(()=>$('addLinkMsg').innerText='',1600); return }
        const t = $('linkTitle').value.trim(), h=$('linkHref').value.trim(); if(!t||!h){ $('addLinkMsg').innerText='Missing'; setTimeout(()=>$('addLinkMsg').innerText='',1200); return }
        addLink(t,h); $('addLinkMsg').innerText='Added'; setTimeout(()=>$('addLinkMsg').innerText='',1200); $('linkTitle').value=''; $('linkHref').value='';
      };

      $('btnReset').onclick = ()=>resetPortal();

    });
  </script>
</body>
</html>
